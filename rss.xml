<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Anton Danshin's Blog RSS Feed]]></title><description><![CDATA[Blog about day-to-day "struggles" of a software developer. ]]></description><link>https://www.antondanshin.com</link><generator>GatsbyJS</generator><lastBuildDate>Sun, 14 Aug 2022 18:29:45 GMT</lastBuildDate><item><title><![CDATA[No title]]></title><description><![CDATA[Many Android projects contain more than one module (subproject). In a product oriented project, it will be one app module and many library…]]></description><link>https://www.antondanshin.com/blog/gradle-convention-plugins</link><guid isPermaLink="false">https://www.antondanshin.com/blog/gradle-convention-plugins</guid><pubDate>Fri, 10 Dec 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Many Android projects contain more than one module (subproject). In a product oriented project, it will be one app module and many library modules. When the team is developing white-label apps, it will be many apps on top of many library modules.&lt;/p&gt;
&lt;p&gt;Here is what I often see in our project. When creating a new module, some developers would use Android Studio GUI and then adjust it according to what they need. Others would simply copy-paste some existing module and change it. Some people would even write build configuration from scratch. Generally, there is nothing wrong with this. Bu over time, this practice had caused us several issues:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Inconsistencies.&lt;/strong&gt; Build configuration might differ from module to module (e.g., could have different &lt;code class=&quot;language-text&quot;&gt;compileSdkVersion&lt;/code&gt;).&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Poor maintainability.&lt;/strong&gt; If we need to apply some new setting to all modules, we will have to change them all.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Redundant logic.&lt;/strong&gt; Build configuration may contain redundant parameters / code, developers are afraid to remove it to break something.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Since we are making wite-labels apps, we have created a script that automates some of the copy-paste we have to do in order to bootstrap the boilerplate for new apps. The amount of duplication in the build logic grows even faster.&lt;/p&gt;
&lt;h2&gt;Sharing external dependencies and versions accross Gradle modules&lt;/h2&gt;
&lt;p&gt;One of the common things developers do, is introducing constants for external libraries. In many projects I see on Github, all versions and library locators are placed to &lt;code class=&quot;language-text&quot;&gt;versions.gradle&lt;/code&gt; in the project’s root directory. The file typically declares version of different libraries and plugins, and also groups all libraries by vendor Then, all the versions and dependencse are placed into Gradle’s &lt;a href=&quot;https://docs.gradle.org/current/dsl/org.gradle.api.plugins.ExtraPropertiesExtension.html&quot;&gt;ExtraPropertiesExtension&lt;/a&gt;, aka &lt;code class=&quot;language-text&quot;&gt;ext&lt;/code&gt;.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;I’ve heard that using &lt;code class=&quot;language-text&quot;&gt;ext&lt;/code&gt; to keep common parameters across subprojects is not a very good practice. I don’t know why exactly… I could certainly find some of its drawbacks if I try. However, our project is currenly using this approach.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Gradle team noticed the trend and came up with a solution called &lt;a href=&quot;https://docs.gradle.org/current/userguide/platforms.html&quot;&gt;Version Catalogs&lt;/a&gt;, which is currently a feature preview. The feature allows you to define versions and libraries in a &lt;code class=&quot;language-text&quot;&gt;*.toml&lt;/code&gt; file. Gradle will generate type-safe accessors based on the declarations in the file.&lt;/p&gt;
&lt;p&gt;You could try using it for new projects. However, if you already have your own “version catalog” that works for you, I don’t really see a need to migrate to the Gradle solution. Compared to defining versions in a Gradle or Kotlin script with IDE support, I found it quite annoying that you have to edit &lt;code class=&quot;language-text&quot;&gt;*.toml&lt;/code&gt;. Apart from syntax highlighing, IDE doesn’t help you with the code completion (at least as of the time of writing this post there was an &lt;a href=&quot;https://youtrack.jetbrains.com/issue/IDEA-262280&quot;&gt;open issue&lt;/a&gt; about that), and you can easily mess it up.&lt;/p&gt;
&lt;h2&gt;Sharing common build logic accross Gradle modules&lt;/h2&gt;
&lt;p&gt;Common pattern that people do here, is either putting the code into &lt;code class=&quot;language-text&quot;&gt;subprojects {}&lt;/code&gt; block of root &lt;code class=&quot;language-text&quot;&gt;build.gradle&lt;/code&gt; file, or put configuration logic into a separate gradle file and apply it to specific module via &lt;code class=&quot;language-text&quot;&gt;apply from: &apos;file.gradle&apos;&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;This is a solution, but because you cannot often split root &lt;code class=&quot;language-text&quot;&gt;build.gradle&lt;/code&gt; into separate files, the file becomes inflated. This also causes subprojects to implicitly &lt;strong&gt;rely&lt;/strong&gt; on configuration logic written in the root &lt;code class=&quot;language-text&quot;&gt;build.gradle&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Fortunately, now there is an easy way split the common build logic into separate gradle files (plugins) that also make subprojects explicitely declare that they are using this configuration. This approach is based on a Gradle feature &lt;a href=&quot;https://docs.gradle.org/current/userguide/custom_plugins.html#sec:precompiled_plugins&quot;&gt;Precompiled Script Plugins&lt;/a&gt; and this is now a recommend way for sharing build logic accorss modules in larger projects. Such precompiled plugins that contain pieces of shared build logic are often referred to as &lt;em&gt;Convention plugins&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;If you don’t have many modules, I think it still OK writing your common build logic the old way. But as project grows, you may not notice how your 10 modules became 30, and 30 become 50… So, why not invest a little bit of time and set up a future proof structure at the early?&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Before applying it to your project, always check whether the benefits that the convention plugins bring outweigh the drawbacks (e.g. potentially slower build or some other issue).&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;The benefits&lt;/strong&gt; of using convention plugins are:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Just like with &lt;code class=&quot;language-text&quot;&gt;subprojects { }&lt;/code&gt; configuration block, you will be able to extract common logic in one place.&lt;/li&gt;
&lt;li&gt;You will be able separate common logic into completely independent bits, which should be easier to maintain.&lt;/li&gt;
&lt;li&gt;You explicitly apply different convention plugins to different modules.&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;By the way! It is possible to migrate to the new approach slowly. I am currently implementing it in our project and have only applied the plugins to a subset of modules. Seems to be working fine.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;The drawbacks&lt;/strong&gt; that I noticed are:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;It requires you to use newer Gradle, as well as new &lt;code class=&quot;language-text&quot;&gt;pluginManagement {}&lt;/code&gt;, which has some issues when used together with the older &lt;code class=&quot;language-text&quot;&gt;builscript&lt;/code&gt;. Ideally, all projects should migrate to new approach.&lt;/li&gt;
&lt;li&gt;It will take a little extra time to compile included build.&lt;/li&gt;
&lt;li&gt;This is not the default way, so when you introduce new team members to the project, they will have to learn your new “conventions”.&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;How to add simple convention plugin&lt;/h2&gt;
&lt;p&gt;Convention plugins are placed into an &lt;a href=&quot;https://docs.gradle.org/current/userguide/composite_builds.html&quot;&gt;included build&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The idea is to put all your build logic into special project, which you can call &lt;code class=&quot;language-text&quot;&gt;build-logic&lt;/code&gt;. It is going to be a standalone gradle project, with its own &lt;code class=&quot;language-text&quot;&gt;settings.gradle&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;build.gradle&lt;/code&gt; scripts and submodules. It can then be declared as an included build in root project’s &lt;code class=&quot;language-text&quot;&gt;settings.gradle&lt;/code&gt;. Alternatively, it can also be included at build time via command line parameter: &lt;code class=&quot;language-text&quot;&gt;./gradlew --include-build build-logic&lt;/code&gt;.&lt;/p&gt;
&lt;h3&gt;Project structure&lt;/h3&gt;
&lt;p&gt;Here is how the project structure would look like:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;plaintext&quot;&gt;&lt;pre class=&quot;language-plaintext&quot;&gt;&lt;code class=&quot;language-plaintext&quot;&gt;root-project
├── build.gradle
├── gradle.properties
├── settings.gradle
├── build-logic
│   ├── build.gradle.kts
│   ├── convention-plugins
│   │   ├── build.gradle.kts
│   │   └── src
│   └── settings.gradle.kts
├── app
│   ├── build.gradle
│   └── src
└── library-module
    ├── build.gradle
    └── src&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Root project config&lt;/h3&gt;
&lt;p&gt;In root-project’s &lt;code class=&quot;language-text&quot;&gt;build.gradle&lt;/code&gt; we need to add the following lines:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;groovy&quot;&gt;&lt;pre class=&quot;language-groovy&quot;&gt;&lt;code class=&quot;language-groovy&quot;&gt;pluginManagement &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    repositories &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;gradlePluginPortal&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;google&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;includeBuild&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;build-logic&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;The &lt;code class=&quot;language-text&quot;&gt;pluginManagement&lt;/code&gt; block is important. Without it convention plugins won’t work.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;There is an &lt;a href=&quot;https://youtrack.jetbrains.com/issue/IDEA-262528&quot;&gt;issue&lt;/a&gt; with IDEA that causes wrong gradle wrapper to be used when running tests from IDE. It can be fixed by setting version of Gradle Wrapper in the root &lt;code class=&quot;language-text&quot;&gt;build.gradle&lt;/code&gt; script:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;groovy&quot;&gt;&lt;pre class=&quot;language-groovy&quot;&gt;&lt;code class=&quot;language-groovy&quot;&gt;tasks&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;withType&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Wrapper&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;configureEach &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    distributionType &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Wrapper&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;DistributionType&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;BIN
    gradleVersion &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token interpolation-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;7.3.1&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// set the same version as in gradle/wrapper/gradle-wrapper.properties&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Included build: build-logic&lt;/h3&gt;
&lt;p&gt;In the &lt;code class=&quot;language-text&quot;&gt;build-logic/settings.gradle.kts&lt;/code&gt; you should have the following lines:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;pluginManagement &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    repositories &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;gradlePluginPortal&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;google&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;mavenCentral&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

dependencyResolutionManagement &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    repositories &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;google&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;gradlePluginPortal&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;mavenCentral&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;include&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;convention-plugins&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Here we define repositories where to find plugins and dependencies for our included build. We also declare a subproject that will contain our convention plugins.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;build.gradle&lt;/code&gt; can be empty.&lt;/p&gt;
&lt;h3&gt;Simple convention plugin&lt;/h3&gt;
&lt;p&gt;Inside &lt;code class=&quot;language-text&quot;&gt;build-logic/convention-plugins/build.gradle.kts&lt;/code&gt; we need to apply &lt;code class=&quot;language-text&quot;&gt;kotlin-dsl&lt;/code&gt; plugin and add a depdendency on Android Gradle Plugin.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;plugins &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    `kotlin&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;dsl`
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

dependencies &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;implementation&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;com.android.tools.build:gradle:7.0.3&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If we would like to use third-party plugins in our pre-compiled script, we must add all of them in the &lt;code class=&quot;language-text&quot;&gt;dependencies&lt;/code&gt; block. Here, for example, we are adding the latest Android Gradle Plugin.&lt;/p&gt;
&lt;p&gt;Then in &lt;code class=&quot;language-text&quot;&gt;build-logic/convention-plugins/src/main/kotlin&lt;/code&gt; we can create a convention plugin, that does some set up of AGP. The id of the plugin will be derived from file name (without extension). Let’s define &lt;code class=&quot;language-text&quot;&gt;convention.android-app&lt;/code&gt; plugin in &lt;code class=&quot;language-text&quot;&gt;convention.android-app.gradle.kts&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;plugins &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;com.android.application&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

android &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    defaultConfig &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        minSdk &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;21&lt;/span&gt;
        targetSdk &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;31&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now any usage of &lt;code class=&quot;language-text&quot;&gt;com.android.application&lt;/code&gt; plugin in our project can be replaced with our convention plugin&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;groovy&quot;&gt;&lt;pre class=&quot;language-groovy&quot;&gt;&lt;code class=&quot;language-groovy&quot;&gt;plugins &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    id &lt;span class=&quot;token string&quot;&gt;&apos;convention.android-app&apos;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The convention plugin will apply Android Aplication plugin and will also set &lt;code class=&quot;language-text&quot;&gt;defaultConfig&lt;/code&gt; that we defined.&lt;/p&gt;
&lt;h2&gt;Resources&lt;/h2&gt;
&lt;p&gt;Before you start digging into this topic, I recommend reading the intro to &lt;a href=&quot;https://docs.gradle.org/current/userguide/custom_plugins.html#sec:precompiled_plugins&quot;&gt;Precompiled Script Plugins&lt;/a&gt; from Gradle. Then explore the examples below:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://docs.gradle.org/current/samples/sample_convention_plugins.html&quot;&gt;Convention plugins&lt;/a&gt; – Oficial sample from Gradle.&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/dsvoronin/march-meetup-gradle&quot;&gt;Android Sample&lt;/a&gt; – More realistic sample with of Android project.&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/avito-tech/avito-android/tree/develop/build-logic&quot;&gt;Real project usage&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Also, I would highly recommend reading Gradle &lt;a href=&quot;https://docs.gradle.org/current/userguide/task_configuration_avoidance.html&quot;&gt;Task Configuration Avoidance&lt;/a&gt; guidelines. Might be useful when writing custom plugins.&lt;/p&gt;
&lt;p&gt;Special thanks to &lt;a href=&quot;https://github.com/dsvoronin&quot;&gt;Dmitriy Voronin&lt;/a&gt; for inspiration and samples.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[No title]]></title><description><![CDATA[Disclaimer: The goal of this article is to share my experience of working with Slack. Everything below is just my opinion. This is not a…]]></description><link>https://www.antondanshin.com/blog/effective-team-communication-in-slack</link><guid isPermaLink="false">https://www.antondanshin.com/blog/effective-team-communication-in-slack</guid><pubDate>Sat, 30 Oct 2021 00:00:00 GMT</pubDate><content:encoded>&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Disclaimer:&lt;/strong&gt; The goal of this article is to share my experience of working with Slack. Everything below is just my opinion. This is not a paid ad, and I am not affiliated with Slack in any way.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Even though Slack has become one of the most popular messaging platforms used by tech companies all over the world, I was surprised to find out that lots of teams are still relying on emails, Skype, and other conventional communications tools. I understand that Slack is not a silver bullet and won’t solve all the communication issues in your team, but I still encourage you to try it.&lt;/p&gt;
&lt;p&gt;At my previous workplace, we initially used Skype. But as the company grew, we quickly transitioned to Slack. Not everything was convenient at first, we had to restructure our chats several times and introduce some rules to make it work for us. But over 5 years there were no major problems and, in my opinion, moving all communications to slack has only benefited us.&lt;/p&gt;
&lt;p&gt;In this article, I will try to give some tips on how to organize your Slack to make it work for your growing company. It might be useful for:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Growing teams who are still using conventional messenger apps.&lt;/li&gt;
&lt;li&gt;Teams that are already using Slack but want to improve their communications.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Problems of private groups and direct messaging&lt;/h2&gt;
&lt;p&gt;I see a lot of problems that are caused by inefficiencies in internal communication in my current workplace. The company is split into teams by platform and functions (i.e. backend, web, Android, iOS, etc). Even though we have Slack in our company, many teams mostly interact over Skype through private groups and direct messages. In some situations, it takes much more time than it should to find answers or get help, especially for new employees.&lt;/p&gt;
&lt;p&gt;Below I will try to outline some problems that we have and how can we organize communications in the company to help mitigate them.&lt;/p&gt;
&lt;h3&gt;Problem: Too many redirects&lt;/h3&gt;
&lt;p&gt;Many times I have a question about the API, but I don’t know exactly whom should I address it. Ideally, I just need to address my question to the backend team and don’t care who will reply. But because there is no public group where I can do it (email doesn’t count), I have to ask individual members of the backend team in direct messages. This sometimes leads to redirects and I have to write the same thing to several people before I can get my answer. I hope the example bellow will better illustrate the situation.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/9f6c3e2ca8b0ef0b33dcbcb106a0bce4/e04e6/communication-redirects.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 40.50632911392405%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABFklEQVQoz02RXbKDIAyF2f/ibt+carX1DxWqoHYBufNlwPEhcEJOkpNgQggSY5R93/XGB2c/v93xnXPngU3btjIMgxzHId57qapKtpSUidu2XcnrukpZlvL9fhXfY3DNOI7y93hI9XpJiFG6vpe473L+fpcSknJxmo7WSj8MKmRxTgtfCgEUfb/f8vl8pOs6NRKstYqJ4fd9r9YST5j48/nURkxp8qgEnfeqBgM3TSPrtul4Ie3POSd2mnSSeZ7VB6MWnkEmSthdTHugCapIoAjEPNKyLLoe3V8I2tCnfcI1HCh0y6KJjD9Nk3aGhIEpnt8xclDl01Qx7dvkHzrPUzvUda3q8O+/RyN2DCZG0aIo9Gai/Gn/8FlVayY7bhYAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Communication redirects causes development delay&quot;
        title=&quot;Communication redirects causes development delay&quot;
        src=&quot;/static/9f6c3e2ca8b0ef0b33dcbcb106a0bce4/f058b/communication-redirects.png&quot;
        srcset=&quot;/static/9f6c3e2ca8b0ef0b33dcbcb106a0bce4/c26ae/communication-redirects.png 158w,
/static/9f6c3e2ca8b0ef0b33dcbcb106a0bce4/6bdcf/communication-redirects.png 315w,
/static/9f6c3e2ca8b0ef0b33dcbcb106a0bce4/f058b/communication-redirects.png 630w,
/static/9f6c3e2ca8b0ef0b33dcbcb106a0bce4/40601/communication-redirects.png 945w,
/static/9f6c3e2ca8b0ef0b33dcbcb106a0bce4/78612/communication-redirects.png 1260w,
/static/9f6c3e2ca8b0ef0b33dcbcb106a0bce4/e04e6/communication-redirects.png 2152w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;small&gt;&lt;strong&gt;Example 1:&lt;/strong&gt; “Communication redirects”. It’s Thursday afternoon, &lt;strong&gt;AD&lt;/strong&gt; (Android) has a few questions about the API. He asks his team lead &lt;strong&gt;AH&lt;/strong&gt; about it, who remembers, a month ago, similar functionality was done by &lt;strong&gt;IK&lt;/strong&gt; on the server-side. Anton then writes to IK, but he is currently working on a high-priority task, and replies with a short delay. IK tells that it was not him who implemented this API, it’s better to ask &lt;strong&gt;YS&lt;/strong&gt;. Anton forwards the question to YS, who came to work earlier today and is already off duty. Later turns out YS has a day off on Friday. On Monday early morning, YS replies. Because they both realized there is some problem, YS adjusted the API a bit. AD finishes his task and opens PR. After code review, the build is ready for testing on Tuesday morning.&lt;/small&gt;&lt;/p&gt;
&lt;p&gt;This example is quite extreme but it has happened before. We can see that we’ve wasted quite some time on redirects here. But if Anton wrote to Yuriy first, he would have had a higher chance to get his answer on Thursday speeding up the release of the feature by at least 1 day. But how would he know whom to write?&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Direct chats (and lack of public groups) cause wasted time through redirects.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;One of the solutions would be to have a public chat for backend team where anyone could ask question. Other people who are also interested in the topic, can see it and will be aware of what’s going on.&lt;/p&gt;
&lt;h3&gt;Problem: No knowledge sharing&lt;/h3&gt;
&lt;p&gt;Because a lot of cross-team communication is done in direct messages, other team members are unaware of conversations (and the decisions that happened during these conversations). If there is someone else involved (e.g., iOS), we have to tell them about it later – probably in yet another direct chat. This might come up as a bug in iOS or can be completely overlooked.&lt;/p&gt;
&lt;p&gt;We have many platform teams working on same projects, sometimes almost in parallel, sometimes with a substantial delay in time. Discussions with the UX designer can happen 1:1 and can result in some changes in the mockups. It is very easy to forget to notify other platform about the change. Let’s take a look at the following example.&lt;/p&gt;
&lt;p&gt;&lt;small&gt; &lt;strong&gt;Example 2.&lt;/strong&gt; “Changes in requirements are not always propagated”. &lt;strong&gt;PE&lt;/strong&gt; (Android) started working on the project first. He has implemented some features and sent them to QA for testing. iOS developer &lt;strong&gt;AB&lt;/strong&gt; started a bit later and found an edge case that was not covered by the mockup. He asked designer about it, and after a discussion they have updated the mockup. Unfortunately they forgot to notify PE about it (which can happen to anyone). As QA started testing Android, they found out that it doesn’t look exactly like the mockup and returned it as an implementation bug.&lt;/small&gt;&lt;/p&gt;
&lt;p&gt;Although, no matter how hard we try to collaborate and discuss questions our peers from other platform, we can sometimes forget to do it. As a result, we have to waste some time on fixing more bugs and testing them. This problem is especially prominent in distributed teams.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Direct messages slow down knowledge sharing&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;If all the communications with designer were conducted in a public channel, all interested parties would have been notified about the updated requirements automatically.&lt;/p&gt;
&lt;h3&gt;Problem: Ineffective onboarding&lt;/h3&gt;
&lt;p&gt;A growing company needs an effective onboarding process. And that’s not very easy to do, especially when you don’t have enough resources. If a new employee needs help, there should be a way for them to get it.&lt;/p&gt;
&lt;p&gt;When nobody is maintaining plublic channels and just texts to each other directly, a newcomer doesn’t even know whom to ask, except their team lead. This puts a huge load on the team lead and makes onboarding process painfully slow.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Direct messages slow down onboarding&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Onboarding problem must be solved on a process level, but this will be never. What you can do now, is encourage discussions of work issues in public channels. This will bring a lot of benefits to onoarding of new employees.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Public channels will let new employees learn what is happening in the company.&lt;/li&gt;
&lt;li&gt;In the team’s public channel, newcomers will be able to see how their team mates answer questions – next time they will know the answers themselves.&lt;/li&gt;
&lt;li&gt;Having access to the entire public communication history of the company will enabled them find some answers without bothering their peers.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Comparison of Slack with conventional messaging apps&lt;/h2&gt;
&lt;p&gt;Before I go into how exactly we organized Slack communications in my previous workplace, I would like to compare Slack with personal messaging apps. Let’s first look at “conventional” messengers.&lt;/p&gt;
&lt;h3&gt;Pros and cons of conventional messengers&lt;/h3&gt;
&lt;p&gt;There are many reasons why using one of the conventional messaging platforms (like Skype) for company internal communications might be appealing:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;You don’t have to pay for it.&lt;/li&gt;
&lt;li&gt;It is popular and everyone has an account.&lt;/li&gt;
&lt;li&gt;It provides UX that everybody knows.&lt;/li&gt;
&lt;li&gt;It is well established and unlikely to stop working.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;All these points make popular personal messaging apps perfect tools for online communications in smaller teams. It is very easy to make group chats there. In the beginning, it would be sufficient for a company to keep communications there. However, as the company grows, the problems of these messengers will become obvious.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Eventually, there will be just too many groups.&lt;/li&gt;
&lt;li&gt;It will be hard to search in the message history.&lt;/li&gt;
&lt;li&gt;You need to manually add new employees to all relevant groups.&lt;/li&gt;
&lt;li&gt;When an employee leaves the company, you need to manually remove them from all groups.&lt;/li&gt;
&lt;li&gt;If you want to keep personal chats separate, you might need to create a separate account for work.&lt;/li&gt;
&lt;li&gt;You cannot control user accounts (e.g., if they have weak passwords, your organization’s communication is at risk).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;This list is not exhaustive, but it is quite obvious, that personal messengers are not a scalable solution for growing companies. That’s why big messengers out there all came up with products for organizations. I have never used them, so cannot comment on how good they are. I assume they all provide the same feature set as Slack and can be a good fit for a growing company.&lt;/p&gt;
&lt;h3&gt;Why Slack is better for growing teams&lt;/h3&gt;
&lt;p&gt;The advantages of Slack compared to conventional messengers are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Each “Organization” in Slack manages its users.&lt;/li&gt;
&lt;li&gt;There are public and private “channels”.&lt;/li&gt;
&lt;li&gt;In the channel, conversations may be organized by threads.&lt;/li&gt;
&lt;li&gt;Slack supports many plugins, chatbots, and integrations with 3rd-party apps.&lt;/li&gt;
&lt;li&gt;It has a good global search tool.&lt;/li&gt;
&lt;li&gt;You can customize notifications based on mentions and keywords.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Disadvantages of Slack&lt;/h3&gt;
&lt;p&gt;Slack is not for every company, as it has its disadvantages (compared to conventional messengers). Here are the ones I could think of:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Slack is quite expensive (with pricing per active user).&lt;/li&gt;
&lt;li&gt;It has a limit of 15 people in video calls (e.g. Telegram supports more).&lt;/li&gt;
&lt;li&gt;It doesn’t show delivered/read flags for messages (but is it really necessary?).&lt;/li&gt;
&lt;li&gt;It doesn’t fully support offline mode (but neither does Skype).&lt;/li&gt;
&lt;li&gt;It sometimes (quite rarely) can be down.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;How to use Slack effectively&lt;/h2&gt;
&lt;p&gt;If you are convinced to use Slack in your team, I have a few tips to make communication more efficient. Keep in mind, this is just my experience, which might not work for your organization.&lt;/p&gt;
&lt;h3&gt;Introducing Slack to your company&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;1. Test on a small team.&lt;/strong&gt; If you don’t have Slack in your company yet, test it on a small team first (you can even start with a free plan). Ensure that it works before forcing all employees to use it. At my previous workplace, my team was the pioneer and started using Slack first in the company.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2. Make Slack a single place to chat.&lt;/strong&gt; As you roll out Slack to all the teams in your organization, make sure they use it for all their internal communications. They should not keep using both old and new ways, as it will ruin the transition. If all company is using Slack, completely stop using the other communication app.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;3. Teach the team how to use Slack.&lt;/strong&gt; You need to make sure people understand how to use Slack to their advantage. Public channels, threads, mentions, reactions, search, etc. More on that below.&lt;/p&gt;
&lt;h3&gt;Users and groups&lt;/h3&gt;
&lt;p&gt;To facilitate more effective communications in Slack I recommend:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Use the same user names as in emails.&lt;/li&gt;
&lt;li&gt;Ask employees to fill out their profiles (avatar, full name, and what they do).&lt;/li&gt;
&lt;li&gt;Create user groups based on department.&lt;/li&gt;
&lt;li&gt;Update user groups when adding new users or when organization structure changes.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Public and private channels&lt;/h3&gt;
&lt;p&gt;Here is how I propose Slack channels should be organized.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1. #general is a channel with all company employees.&lt;/strong&gt; Use it for company announcements or if you have a question that you don’t know who should answer.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2. Each team must have a PRIVATE channel.&lt;/strong&gt; Private channel is used by the team for its private communications. Just like in plain old Skype, a team may want to create other private channels for CI notifications or other things if they need to.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;3. Each team must have a PUBLIC channel.&lt;/strong&gt; This is how they interface with other teams of the company. Anyone in the company must know (or be able to quickly find) a public channel of any team, read it or ask questions.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;4. Theme channels.&lt;/strong&gt; It might be a good idea to create theme channels devoted to a particular topic. For example, &lt;code class=&quot;language-text&quot;&gt;#office&lt;/code&gt; (discussing office issues), &lt;code class=&quot;language-text&quot;&gt;#vacations&lt;/code&gt; – to announce days off, &lt;code class=&quot;language-text&quot;&gt;#jokes&lt;/code&gt; – channel for fun memes.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;5. Temporary channels for big projects.&lt;/strong&gt; You may want to create temporary channels for big projects (that last for months).&lt;/p&gt;
&lt;p&gt;All public channels must have a meaningful name and description, should be easily discovered.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Example:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Public channels:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;#general
#android
#ios
#frontend
#backend
#qa
#product
#design
#accounting
#operations
#sales
#it-infrastructure
...&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Private channels:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;#android-private
#backend-private
#ios-private
#qa-private
...&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;How to maintain a public channel&lt;/h3&gt;
&lt;p&gt;To make communications in Slack more efficient, it is important to follow certain rules when chatting in public channels.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1. Keep questions on the topic.&lt;/strong&gt; Make sure people don’t ask backend questions in &lt;code class=&quot;language-text&quot;&gt;#product&lt;/code&gt; channel. Add some guidelines to description. When question is asked in a wrong place, redirect them immediately to the right channel.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2. Reply in a thread.&lt;/strong&gt; When a question is asked in a public channel, reply in a thread. This will ensure other external members will not be notified.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;3. Moderate conversations.&lt;/strong&gt; Make sure conversations are on a topic and professional (jokes and sarcasm must be redirected to appropriate channel). Don’t blame people for problems, suggest solutions and preventative measures.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;4. Ensure quick reaction.&lt;/strong&gt; It will all work better if questions are answered. Try to answer questions asap. If you don’t know the answer, but you know the person who does, reply to the question by mentioning that person. The team can also arrange a schedule for team members to answer questions.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;5. Mark questions as resolved.&lt;/strong&gt; Usually the one who asked should mark their question as resolved. If there are multiple questions, the channel owner team will not which questions are still waiting for an answer.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;6. Collect common questions and answers.&lt;/strong&gt;. You might see that questions repeat. Ask people to search before they ask, pin useful conversation threads/resources or put common answers to a Confluence page and place a link to the topic of the chat.&lt;/p&gt;
&lt;h3&gt;How to stay responsive on Slack&lt;/h3&gt;
&lt;p&gt;Here is how I would work with Slack to make sure it doesn’t distract me too much and I am still responsive.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1. Star important chats.&lt;/strong&gt; To be in close communication with people and teams that I work with, I will add them to favorites (“star” them). This way, they are displayed on top of the list and there is less chance to miss an important message.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2. Setup notifications.&lt;/strong&gt; I might set all notifications for important channels, set keyword notifications / direct mentions in some channels. Experiment and find what works for you and what doesn’t.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;3. Mute all unimportant channels.&lt;/strong&gt; I will mute channels that are not important (if I haven’t left them) to reduce distraction.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;4. Reply in threads.&lt;/strong&gt; When replying to messages in public channels, I will always do it in a thread.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;5. Sort out messages in the morning.&lt;/strong&gt; I will check Slack in the morning and try to reply to all messages.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;6. Check Slack periodically.&lt;/strong&gt; I will react on direct mentions asap. In other cases, I will check my Slack periodically to see what’s going on.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;7. Mark my status.&lt;/strong&gt; I will try to keep my Slack status up-to-date. If I’m on vacation I set the corresponding status icon and vacation dates, so that everybody knows I’m unavailable.&lt;/p&gt;
&lt;h3&gt;How to follow public channels&lt;/h3&gt;
&lt;p&gt;You don’t need to be subscribed to all the channels. In fact, what channels you follow and how often you check them depend on where you work, what you are currently working on, as well as on your personality.&lt;/p&gt;
&lt;p&gt;Slack allows you to configure notifications for each channel individually. You may choose to be notified about any message, direct mention and/or based on a keyword. You may also choose to completely mute the channel. Use notification settings to minimize distraction and maximize your responsiveness.&lt;/p&gt;
&lt;p&gt;Here is how I would organize my channel notifications.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;As a regular employee of the company, I should be a member of &lt;code class=&quot;language-text&quot;&gt;#general&lt;/code&gt;. I will probably mute it though and only enable direct mentions and some keywords.&lt;/li&gt;
&lt;li&gt;As an Android developer, I should be a member of a public channel &lt;code class=&quot;language-text&quot;&gt;#android&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;#android-private&lt;/code&gt; channels. I need to watch them regularly to be able to help my team and answer questions from other teams.&lt;/li&gt;
&lt;li&gt;Because I often need to work with the iOS team on the same tasks and interact with the server APIs, I would also join, &lt;strong&gt;mute&lt;/strong&gt; and occasionally read &lt;code class=&quot;language-text&quot;&gt;#ios&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;#backend&lt;/code&gt; public channels, just to be aware of what’s going on (people ask questions I might be interested to know the answer). I would probably also let Slack notify me of any mentions of the word “android” in these channels.&lt;/li&gt;
&lt;li&gt;Depending on my current tasks, I might sometimes need to join other public channels to ask questions.&lt;/li&gt;
&lt;li&gt;I would Leave channels that I haven’t read for a while (Slack has reminders for that).&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;If you decided to use Slack, I recommend placing this article in your company’s public knowledge base, such as Confluence. Ensure that everyone on your team is on the same page by letting them read the guidelines. Monitor how it works and listen to the feedback. Experiment and adjust the rules to suit your needs.&lt;/p&gt;
&lt;p&gt;The presented structure of Slack channels may not work for every company. Some of the points may seem too obvious, but it is still useful to be aware of them. I hope someone will find this useful and improve their communication.&lt;/p&gt;
&lt;p&gt;Thanks for reading.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[No title]]></title><description><![CDATA[I have been working as an Android developer professionally for more than 6 years now. While it is not huge compared to many people out there…]]></description><link>https://www.antondanshin.com/blog/tips-for-junior-developers</link><guid isPermaLink="false">https://www.antondanshin.com/blog/tips-for-junior-developers</guid><pubDate>Mon, 25 Oct 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;I have been working as an Android developer professionally for more than 6 years now. While it is not huge compared to many people out there, however, there are even more people who are just starting their software development career and might find my experience useful.&lt;/p&gt;
&lt;p&gt;In this article, I want to share my advice to all junior software developers that would help them work more efficiently and move faster along the career ladder.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Disclaimer:&lt;/strong&gt; The following tips are based on my own experience and express my own opinion that I had at the moment of writing. Other people might have completely different views, and that’s ok!&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;General tips&lt;/h2&gt;
&lt;p&gt;Just some basic tips that any (especially) beginner developer should always follow, that would make an impact on your career.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1. Be proficient in your programming language.&lt;/strong&gt; At work you will be dealing with high-level problems and thinking about how to write a for-loop, or “why this doesn’t compile?” will slow you down. Just like musicians, programmers must know their instrument and be able to write code with their eyes closed (e.g. without the help of the IDE). So, learn fundamentals, know how to write basic algorithms, know the standard library of your programming language, learn tools that you need to work with.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2. Always stay curious.&lt;/strong&gt; Look in the internals and try to get the basic idea of how it works. If you don’t understand – ask. It is often important to know not just how something works but &lt;strong&gt;why&lt;/strong&gt; it is done this way. So, don’t forget about the “why” question. It will help you to make your own decisions in the future.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;3. Admit that you don’t know or understand something.&lt;/strong&gt; No one knows everything, even senior developers. You are expected to have gaps in knowledge and can misunderstand something. Be honest with yourself, admit what you don’t know, and learn from your peers.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;4. Learn about the product you are building.&lt;/strong&gt; Understand what are the typical users and how they are interacting with the product. Learn about the product roadmap. Participate in feature discussions and try to contribute to the backlog by suggesting your ideas.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;5. Don’t be shy to ask for help.&lt;/strong&gt; If you are stuck, follow the tips below but always remember not to be afraid to ask your teammates for help. I think some people are just shy and don’t want to disturb senior peers, but this is a mistake. Juniors are expected to be asking questions. If you indeed ask too many questions, we will let you know.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;6. Keep an eye on what’s happening around you.&lt;/strong&gt; If you are working in the office, don’t ignore what’s happening around you. Some of my colleagues used to listen to music and missed out on some information that was briefly said by other team members. Make sure you have some idea of what’s going on in your team and the company, what are the priorities.&lt;/p&gt;
&lt;h2&gt;Get familiar with the company’s processes&lt;/h2&gt;
&lt;p&gt;When you start working in a company, it is important to learn about how things are done there.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1. Look into task workflows.&lt;/strong&gt; Understand what are the main types of tasks you and your team have to deal with. Learn the workflow for each type of task. Pay special attention to how tasks are assigned, who is supposed to transition tasks from one status to another, and how tasks are resolved.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2. Understand how QA is done.&lt;/strong&gt; All tasks undergo some kind of verification process. It will be extremely important to know how this is done in the company. Depending on when and how QA is involved in the development process, you might need to provide certain information to the QA, so that they can do their job more efficiently. Alternatively, you get test cases from QA to help you understand the requirements.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;3. Understand the release process.&lt;/strong&gt; Learn what happens to the featrue after development and QA are done. Depending on the company and the product, the release process maybe fullly automated or it can be done manually. In any case, it’s important to know how it happend the developed feature is delivered to the end used.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;4. Learn git workflows in your team.&lt;/strong&gt; Ask your team lead about git workflows. You will need to know what are the main and development branches and what you need to do when you start development. There might be conventions in naming branches as well as requirements for commit messages. Does the team use allow rebase? Do you need to squash commits, add tags? When shoud you delete your feature branch?&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;5. Follow the coding conventions of your team.&lt;/strong&gt; TODO.&lt;/p&gt;
&lt;h2&gt;Get familiar with tools&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;1. Use the same tools that your team is using.&lt;/strong&gt; TODO.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;2. Learn how to debug project on the local machine.&lt;/strong&gt; TODO.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;3. Learn about development / testing environments (if any).&lt;/strong&gt; TODO.&lt;/p&gt;
&lt;h2&gt;Before starting new task&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;Understand the problem (what and why).&lt;/li&gt;
&lt;li&gt;Discuss the scope of work (what should be included what shouldn’t)&lt;/li&gt;
&lt;li&gt;Make sure you understand how it is supposed to be done.&lt;/li&gt;
&lt;li&gt;Learn about how it is going to be tested, released.&lt;/li&gt;
&lt;li&gt;If something is missing – Ask questions!&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;When working on the task&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;Work on your own branch, make commits.&lt;/li&gt;
&lt;li&gt;Tell about your progress / blockers to your mentor at least once a day.&lt;/li&gt;
&lt;li&gt;If you work on the task for several days, pull changes from parent once a day.&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;Troubleshoot if something doesn’t work&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;If it worked before – try to comment out some changes you made and see if it fixes the issue&lt;/li&gt;
&lt;li&gt;Use logging to identify where the problem starts to appear in the code&lt;/li&gt;
&lt;li&gt;Make sure your changes are applied: restart dev server / virtual machine, restart IDE, clear caches, reinitialize project&lt;/li&gt;
&lt;li&gt;Look at other examples of the same functionality in the project codebase or on the Internet and note the differences with your code.&lt;/li&gt;
&lt;li&gt;Go through the code from very start, verify logic, track data / event flow, make sure it is correct.&lt;/li&gt;
&lt;li&gt;Do not waste too much time (time limit troubleshooting process)&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;If you are stuck you have several options (choose any)&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;If it is late night – stop, there is high chance you will figure it out next morning.&lt;/li&gt;
&lt;li&gt;If the issue is not a blocker – switch something else for a while, then come back to it.&lt;/li&gt;
&lt;li&gt;Tell your peers about the problem in a team’s group chat, ask for help (sometimes while you explain the problem, you will realize where the issue is).&lt;/li&gt;
&lt;li&gt;Tell your mentor about the problem, ask for help&lt;/li&gt;
&lt;li&gt;Try to reproduce a bug in a simple setup (sandbox project), it can give you a clue.&lt;/li&gt;
&lt;li&gt;Ask question on stack overflow&lt;/li&gt;
&lt;li&gt;Don’t fix it, look for workarounds / alternative ways to implement this&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;Before you make a pull-request&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;Review your own code!&lt;/li&gt;
&lt;li&gt;Remove all commented-out code&lt;/li&gt;
&lt;li&gt;Try not to change unrelated files (unless necessary)&lt;/li&gt;
&lt;li&gt;Format your code, make sure it follows same code style.&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;Pull request&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;Write short description about your change.&lt;/li&gt;
&lt;li&gt;Reference an issue / ticket that your PR is related to.&lt;/li&gt;
&lt;li&gt;Add a screenshot (if it is a UI change)&lt;/li&gt;
&lt;li&gt;Look how other people do PRs for reference.&lt;/li&gt;
&lt;li&gt;Leave comments to your code in PR to bring attention of the reviewers to particular places in the code.&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;Replying to code review comments&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;If you don’t understand clearly what comment asks you to do – ask for clarification.&lt;/li&gt;
&lt;li&gt;If you don’t understand why comment requests you to do it – ask why?&lt;/li&gt;
&lt;li&gt;Learn from your mistakes and try not to repeat them.&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;After you are done with the task&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;Take next one that was assigned to you.&lt;/li&gt;
&lt;li&gt;Ask your mentor / team lead for a new task.&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;If you don’t have a task&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;Continue learning through documentation / articles / books / online courses&lt;/li&gt;
&lt;li&gt;Contribute to code review – review other people’s PRs&lt;/li&gt;
&lt;li&gt;Look into project’s code base, learn how things work.&lt;/li&gt;
&lt;li&gt;Try to find a task for yourself in the project’s backlog.&lt;/li&gt;
&lt;li&gt;Find obvious issues in the code (it could be just code style issues) and fix it.&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;Reviewing other people’s code&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;Look at other people’s PR, learn from their code&lt;/li&gt;
&lt;li&gt;If you see places you don’t understand, you can leave a comment.&lt;/li&gt;
&lt;li&gt;If you notice violation of coding conventions – point it out in the comment.&lt;/li&gt;
&lt;li&gt;If you see something can be improved, always give reasons why you think so and try to suggest a better way.&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;TODO.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[No title]]></title><description><![CDATA[When you want to display different users in your app, it is a good idea to provide an image. For example, when scrolling through the list…]]></description><link>https://www.antondanshin.com/blog/compose-user-avatar-placeholder</link><guid isPermaLink="false">https://www.antondanshin.com/blog/compose-user-avatar-placeholder</guid><pubDate>Sun, 17 Oct 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;When you want to display different users in your app, it is a good idea to provide an image. For example, when scrolling through the list some people would mostly pay attention to the text, but some will look at images. That’s why a lot of apps that contain list of people, (e.g. a Contacts app), always provide an avatar.&lt;/p&gt;
&lt;p&gt;Not all users might have avatars. If the avatar is missing, it is often replaced with a placeholder. I find that the best placeholder should contain user initials and have a different color per user. This way, it is easier to identify different people in the list just by looking at the avatar placeholder.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/7f63bef6c3b81bb0107600e4a734c676/d1882/material-letter-icons.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 19.62025316455696%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA/0lEQVQI1wH0AAv/AOL49ZTk2d/39P///6bsxLXuzf///9Tb/665/vb6///z8e2Wl/bLy//////UtP/MqP///PPe/9uU/vXj/wBDz7wAv6RG0MKR57YFyFYS0Fui29FVZ/8gQfqBnv/yc2nVCAncMjf6t5j/fRb/dQz9vZe8QP+rAfzCR/8AO825AL+kPc6/gOOsBshXDc9YktTKTmD/JEX5dZP/8GVb1AgJ2igt+ayJ/3cM/3EF/LOMuDP/qgD8vTn/ANP073bcztDz7/3//IrlsZvpvP///8bO/5in/u70///q5+h5evO5uf/////Emf+8jf//+O7O/9J3/vHU/6YAq+QqAuEOAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Material letter icons as avatar placeholders&quot;
        title=&quot;Material letter icons as avatar placeholders&quot;
        src=&quot;/static/7f63bef6c3b81bb0107600e4a734c676/f058b/material-letter-icons.png&quot;
        srcset=&quot;/static/7f63bef6c3b81bb0107600e4a734c676/c26ae/material-letter-icons.png 158w,
/static/7f63bef6c3b81bb0107600e4a734c676/6bdcf/material-letter-icons.png 315w,
/static/7f63bef6c3b81bb0107600e4a734c676/f058b/material-letter-icons.png 630w,
/static/7f63bef6c3b81bb0107600e4a734c676/40601/material-letter-icons.png 945w,
/static/7f63bef6c3b81bb0107600e4a734c676/78612/material-letter-icons.png 1260w,
/static/7f63bef6c3b81bb0107600e4a734c676/d1882/material-letter-icons.png 1562w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;In this article, I will look into how we can draw such an avatar placeholder in Jetpack Compose.&lt;/p&gt;
&lt;h2&gt;Requirements&lt;/h2&gt;
&lt;p&gt;Just list a few requirements to our avatar placeholder:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;It should display the initials of the user on a circle with some background color.&lt;/li&gt;
&lt;li&gt;Text must always be legible with a good contrast ratio – e.g., black text on a brown background is no good.&lt;/li&gt;
&lt;li&gt;If two users have the same initials, the color should be different.&lt;/li&gt;
&lt;li&gt;For the same user, it should use the same background color.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Implementation&lt;/h2&gt;
&lt;p&gt;Input: user ID and full name.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Convert user data to color using HSV color space.&lt;/li&gt;
&lt;li&gt;Draw a circle.&lt;/li&gt;
&lt;li&gt;Draw Initials.&lt;/li&gt;
&lt;li&gt;Put it all together.&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;Generating color by user name&lt;/h3&gt;
&lt;p&gt;In our code, we represent color as a 32-bit integer (ARGB format). What if we use a hashcode of the user name as color? It might work, but we often end up having colors that are too dark, too light, or even too transparent.&lt;/p&gt;
&lt;p&gt;Ideally, we want our color to have a fixed brightness – different users would have different color of the same brightness and saturation levels. Lucky for us there are color encodings that split the color into exactly these components.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;HSL&lt;/strong&gt; (for hue, saturation, lightness) and &lt;strong&gt;HSV&lt;/strong&gt; (for hue, saturation, value; also known as &lt;strong&gt;HSB&lt;/strong&gt;, for hue, saturation, brightness) are alternative representations of the &lt;strong&gt;RGB&lt;/strong&gt; color model, designed in the 1970s by computer graphics researchers to more closely align with the way human vision perceives color-making attributes. In these models, colors of each hue are arranged in a radial slice, around a central axis of neutral colors which ranges from black at the bottom to white at the top. — &lt;a href=&quot;https://en.wikipedia.org/wiki/HSL_and_HSV&quot;&gt;Wikipedia&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;We can use HSL color space and fix saturation and lightness. In my app I found that &lt;code class=&quot;language-text&quot;&gt;lightness = 0.4f&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;saturation = 0.5f&lt;/code&gt; work the best.&lt;/p&gt;
&lt;p&gt;Here is how we can convert a &lt;code class=&quot;language-text&quot;&gt;String&lt;/code&gt; into a color in Android using &lt;code class=&quot;language-text&quot;&gt;HSL&lt;/code&gt; color space:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token annotation builtin&quot;&gt;@ColorInt&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; String&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toHslColor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    saturation&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Float &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0.5f&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    lightness&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Float &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0.4f&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Int &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; hashCode &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;fold&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; acc&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; char &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; char&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;code &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; acc &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;37&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; hue &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;hue &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;360&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;absoluteValue&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toFloat&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; ColorUtils&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;HSLToColor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;floatArrayOf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;hue&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; saturation&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; lightness&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We can then generate a color by user name:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// generate full name string&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;listOf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;firstName&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; lastName&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;joinToString&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;separator &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;uppercase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; color &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; name&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toHslColor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The only problem here is that users that share the same name will be given the same color. This can be fixed by adding user ID into the mix.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; color &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token expression&quot;&gt;id&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt; / &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token expression&quot;&gt;name&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toHslColor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Drawing background circle&lt;/h3&gt;
&lt;p&gt;Now we can simply draw a circle for a given user full name on &lt;code class=&quot;language-text&quot;&gt;Canvas&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token function&quot;&gt;Canvas&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;modifier &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Modifier&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;fillMaxSize&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;drawCircle&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;SolidColor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;color&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Draw initials&lt;/h3&gt;
&lt;p&gt;To draw initials on top of our background, we need to wrap both of them with a &lt;code class=&quot;language-text&quot;&gt;Box&lt;/code&gt; layout.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token function&quot;&gt;Box&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;contentAlignment &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Alignment&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Center&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// ...&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; initials &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;firstName&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;take&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; lastName&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;take&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;uppercase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;Text&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;text &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; initials&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Putting it all together&lt;/h3&gt;
&lt;p&gt;When creating a component, it would be a good idea to provide some basic customization. In my implementation, I only need to have different sizes and text styles.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre class=&quot;language-kotlin&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token annotation builtin&quot;&gt;@Composable&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;UserHead&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    id&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; String&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    firstName&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; String&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    lastName&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; String&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    modifier&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Modifier &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Modifier&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    size&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Dp &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;40&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dp&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    textStyle&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; TextStyle &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; MaterialTheme&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;typography&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;subtitle1&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;Box&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;modifier&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;size&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; contentAlignment &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Alignment&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Center&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;listOf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;firstName&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; lastName&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;joinToString&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;separator &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;uppercase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; color &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Color&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token expression&quot;&gt;id&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt; / &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token expression&quot;&gt;name&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toHslColor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; initials &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;firstName&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;take&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; lastName&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;take&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;uppercase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;Image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
            painter &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;ColorPainter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;color&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            modifier &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Modifier&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;clip&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;CircleShape&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            contentDescription &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Avatar&quot;&lt;/span&gt;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;Canvas&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;modifier &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Modifier&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;fillMaxSize&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;drawCircle&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;SolidColor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;color&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;Text&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;text &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; initials&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; style &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; textStyle&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; color &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Color&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;White&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Here is how the component is rendered:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 428px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/41bfed567aabfc18eae15a48c53ef39c/47730/circle-avatar-placeholder.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 46.202531645569614%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABjklEQVQoz52Sy27aQBSGeYnAwilZgBmPZ4aZAVpRxTI3g4MByeGiVoIWRXmDSFlk0UdpniGrqIu821/NcZwoWUVZfDq/zpzzz+1UarUa6qenqHsexTOvgHKfoFKtVuE3m1BSQgiBpixwWpZI+QbxnFPv8q62Uj05AWcMptOBNQY/lcYPpUlra6G1LpqVejGy1lIMRbExrUkJY0xhGDAGaQ1uwzYeWBsPXONGajApcJGmOB6P2Gw22O12WK1WuMxz7Pd7bLdbHA4Hwq33er3CsMUYvmmNe9nB068rPP2+xl/ZgVEK8WCARZYhSRIsl0uMx2PEcUzGWZZRnE6nmM/nr4buhMoY/JEGj93v+NePcSc0uFKYJgnt7sxck2t2RrPZDHmeY7FYYL1eo9vt0tXfvOFXY3AlFI6hQs9atI1Bv9/HaDSiUw2HQ0RRRPo8ijCZTEinaUp17r3pl5uNBkQYIuAcjTAkOOcIOUcQBGCt1gvuNmVs+T5p3/epztVXyjn84uaQZtAjnC5n88N4Hv4DLbocTuFez+YAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Avatar placeholder with initials and color background example&quot;
        title=&quot;Avatar placeholder with initials and color background example&quot;
        src=&quot;/static/41bfed567aabfc18eae15a48c53ef39c/47730/circle-avatar-placeholder.png&quot;
        srcset=&quot;/static/41bfed567aabfc18eae15a48c53ef39c/c26ae/circle-avatar-placeholder.png 158w,
/static/41bfed567aabfc18eae15a48c53ef39c/6bdcf/circle-avatar-placeholder.png 315w,
/static/41bfed567aabfc18eae15a48c53ef39c/47730/circle-avatar-placeholder.png 428w&quot;
        sizes=&quot;(max-width: 428px) 100vw, 428px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;With just 20 lines of code, we have created a simple Jetpack Compose component to display a colorful avatar placeholder with user initials. Follow &lt;a href=&quot;https://gist.github.com/ntoskrnl/14622d88cad3387d14786aa259e4653f&quot;&gt;this link&lt;/a&gt; to see all the code.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[No title]]></title><description><![CDATA[In my app I need to display some sort of timers and clocks in several places, so I thought it would be nice to make a stateful component for…]]></description><link>https://www.antondanshin.com/blog/compose-timer-implementation</link><guid isPermaLink="false">https://www.antondanshin.com/blog/compose-timer-implementation</guid><pubDate>Tue, 28 Sep 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;In my app I need to display some sort of timers and clocks in several places, so I thought it would be nice to make a stateful component for it. I looked online and found several good and bad implementations of it. So I decided to share my views and how I would go about this problem.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/0bfe4fbd4ef1f0920b486881f6c2f6d5/3acf0/countdown-timer.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 45.56962025316456%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAJABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAMEAgX/xAAVAQEBAAAAAAAAAAAAAAAAAAACAf/aAAwDAQACEAMQAAABfJ3Fl0Gij//EABsQAAAHAQAAAAAAAAAAAAAAAAABAgQREzES/9oACAEBAAEFAnN1suAieFaCz//EABURAQEAAAAAAAAAAAAAAAAAABAS/9oACAEDAQE/AaP/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAaEAACAgMAAAAAAAAAAAAAAAAAEQEgIjFC/9oACAEBAAY/AsGjoh7p/8QAGhAAAgMBAQAAAAAAAAAAAAAAAAERMXEhUf/aAAgBAQABPyF08vkMnuOMwZSXCKD/2gAMAwEAAgADAAAAED//AP/EABgRAAMBAQAAAAAAAAAAAAAAAAABESEx/9oACAEDAQE/EFGQfT//xAAVEQEBAAAAAAAAAAAAAAAAAAAQEf/aAAgBAgEBPxCH/8QAGxAAAgMBAQEAAAAAAAAAAAAAAREAITGhYcH/2gAIAQEAAT8QPiZpRQatoysAs0p+zUu09VzmmzOAT//Z&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Countdown timer&quot;
        title=&quot;Countdown timer&quot;
        src=&quot;/static/0bfe4fbd4ef1f0920b486881f6c2f6d5/828fb/countdown-timer.jpg&quot;
        srcset=&quot;/static/0bfe4fbd4ef1f0920b486881f6c2f6d5/ff44c/countdown-timer.jpg 158w,
/static/0bfe4fbd4ef1f0920b486881f6c2f6d5/a6688/countdown-timer.jpg 315w,
/static/0bfe4fbd4ef1f0920b486881f6c2f6d5/828fb/countdown-timer.jpg 630w,
/static/0bfe4fbd4ef1f0920b486881f6c2f6d5/0ede0/countdown-timer.jpg 945w,
/static/0bfe4fbd4ef1f0920b486881f6c2f6d5/3ac88/countdown-timer.jpg 1260w,
/static/0bfe4fbd4ef1f0920b486881f6c2f6d5/3acf0/countdown-timer.jpg 2000w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;small&gt; — Design vector created by pikisuperstar &lt;a href=&quot;https://www.freepik.com/vectors/design&quot;&gt;www.freepik.com&lt;/a&gt;&lt;/small&gt;&lt;/p&gt;
&lt;h2&gt;The problem&lt;/h2&gt;
&lt;p&gt;Let’s set our goal first. We want to implement a component that allows you to display a countdown timer.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;There shouldn’t be any assumption on how it will be displayed: it can be a &lt;code class=&quot;language-text&quot;&gt;Text()&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;Canvas()&lt;/code&gt; or anything.&lt;/li&gt;
&lt;li&gt;The first displayed state should be initial state&lt;/li&gt;
&lt;li&gt;The last displayed state must be 0 (never negative).&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Simple solution – Naive approach&lt;/h2&gt;
&lt;p&gt;To achieve that, we can create a &lt;code class=&quot;language-text&quot;&gt;MutableState&amp;lt;Long&gt;&lt;/code&gt; that would update itself in a &lt;code class=&quot;language-text&quot;&gt;LaunchedEffect&lt;/code&gt;. The users will just need to render it and the UI will automatically be updated on change.&lt;/p&gt;
&lt;p&gt;Here is how it can be used:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre style=&quot;counter-reset: linenumber 0&quot; class=&quot;language-kotlin line-numbers&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token annotation builtin&quot;&gt;@Composable&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;MyTimer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; timeLeftMs &lt;span class=&quot;token keyword&quot;&gt;by&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;rememberCountdownTimerState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5_000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;Text&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal singleline&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;token expression&quot;&gt;timeLeftMs&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt; ms left&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot; style=&quot;white-space: normal; width: auto; left: 0;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;A simple implementation would look like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre style=&quot;counter-reset: linenumber 0&quot; class=&quot;language-kotlin line-numbers&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token annotation builtin&quot;&gt;@Composable&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;rememberCountdownTimerState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    initialMillis&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Long&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    step&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Long &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; MutableState&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Long&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; timeLeft &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; remember &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;mutableStateOf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;initialMillis&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;LaunchedEffect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;initialMillis&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; step&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;isActive &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; timeLeft&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;value &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            timeLeft&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;value &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;timeLeft&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;value &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; step&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;coerceAtLeast&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;delay&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;step&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; timeLeft
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot; style=&quot;white-space: normal; width: auto; left: 0;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It will work, but it has several obvious problems:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The last delay could be longer than actually needed, so &lt;code class=&quot;language-text&quot;&gt;0&lt;/code&gt; state will be rendered with up to 99 ms delay.&lt;/li&gt;
&lt;li&gt;There is not account of time that took to execute &lt;code class=&quot;language-text&quot;&gt;onTick()&lt;/code&gt;, and there is no guarantee that &lt;code class=&quot;language-text&quot;&gt;delay(n)&lt;/code&gt; will return resume after exactly &lt;code class=&quot;language-text&quot;&gt;n&lt;/code&gt; ms.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The first problem can be quickly fixed by making sure we never &lt;code class=&quot;language-text&quot;&gt;delay&lt;/code&gt; by more than &lt;code class=&quot;language-text&quot;&gt;timeLeft&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre style=&quot;counter-reset: linenumber 0&quot; class=&quot;language-kotlin line-numbers&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token annotation builtin&quot;&gt;@Composable&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;rememberCountdownTimerState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    initialMillis&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Long&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    step&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Long &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; MutableState&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Long&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; timeLeft &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; remember &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;mutableStateOf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;initialMillis&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;LaunchedEffect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;initialMillis&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; step&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;isActive &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; timeLeft&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;value &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            timeLeft&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;value &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;timeLeft&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;value &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; step&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;coerceAtLeast&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;delay&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;step&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;coerceAtMost&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;timeLeft&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;value&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; timeLeft
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot; style=&quot;white-space: normal; width: auto; left: 0;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;To fix second problem we need to use system clock.&lt;/p&gt;
&lt;h2&gt;Better solution – Using SystemClock&lt;/h2&gt;
&lt;p&gt;Instead of &lt;code class=&quot;language-text&quot;&gt;System.currentTimeMillis()&lt;/code&gt; available in Java, for this particular task it is recommented to use some monotonic time source, such as Android &lt;code class=&quot;language-text&quot;&gt;SystemClock.uptimeMillis()&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;The idea is to remember when we started our timer in &lt;code class=&quot;language-text&quot;&gt;startTime&lt;/code&gt; and on each cycle of the loop check how much time has actually passed (&lt;code class=&quot;language-text&quot;&gt;duration&lt;/code&gt;).&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre style=&quot;counter-reset: linenumber 0&quot; class=&quot;language-kotlin line-numbers&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token annotation builtin&quot;&gt;@Composable&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;rememberCountdownTimerState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    initialMillis&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Long&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    step&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Long &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; MutableState&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Long&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; timeLeft &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; remember &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;mutableStateOf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;initialMillis&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;LaunchedEffect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;initialMillis&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; step&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; startTime &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; SystemClock&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;uptimeMillis&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;isActive &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; timeLeft&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;value &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// how much time actually passed&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; duration &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;SystemClock&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;uptimeMillis&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; startTime&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;coerceAtLeast&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            timeLeft&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;value &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;initialMillis &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; duration&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;coerceAtLeast&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;delay&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;step&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;coerceAtMost&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;timeLeft&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;value&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; timeLeft
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot; style=&quot;white-space: normal; width: auto; left: 0;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The solution solution works perfectly fine, but if we were to publish it as a library and let other people use it, we would probably want to add some tests to it (e.g. screenshot tests). To make it testable we can pass a lambda as our time source, which would default to &lt;code class=&quot;language-text&quot;&gt;SystemClock.uptimeMillis()&lt;/code&gt;.&lt;/p&gt;
&lt;h2&gt;Alternative solution – Using withFrameMillis&lt;/h2&gt;
&lt;p&gt;If we dig into how animated components are tested, we can find that compose has its own built-in monotonic time source – &lt;code class=&quot;language-text&quot;&gt;MonotonicFrameClock&lt;/code&gt;. It is an abstraction over Choreographer, if we provide another implementation in unit-tests, it will allow to control time there.&lt;/p&gt;
&lt;p&gt;Here is how we can rewrite our component to use this &lt;code class=&quot;language-text&quot;&gt;withFrameMillis()&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;kotlin&quot;&gt;&lt;pre style=&quot;counter-reset: linenumber 0&quot; class=&quot;language-kotlin line-numbers&quot;&gt;&lt;code class=&quot;language-kotlin&quot;&gt;&lt;span class=&quot;token annotation builtin&quot;&gt;@Composable&lt;/span&gt;
&lt;span class=&quot;token annotation builtin&quot;&gt;@OptIn&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ExperimentalComposeApi&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;rememberCountdownTimerState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    initialMillis&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Long&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    step&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Long &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; MutableState&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Long&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; timeLeft &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; remember &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;mutableStateOf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;initialMillis&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;LaunchedEffect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;initialMillis&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; step&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; startTime &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; withFrameMillis &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; it &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;isActive &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; timeLeft&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;value &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;val&lt;/span&gt; duration &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; withFrameMillis &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; time &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;time &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; startTime&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;coerceAtLeast&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
            timeLeft&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;value &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;initialMillis &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; duration&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;coerceAtLeast&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;delay&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;step&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;coerceAtMost&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;timeLeft&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;value&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; timeLeft
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;span aria-hidden=&quot;true&quot; class=&quot;line-numbers-rows&quot; style=&quot;white-space: normal; width: auto; left: 0;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The advantage of this implementation is that it can be tested using &lt;code class=&quot;language-text&quot;&gt;ComposeTestRule&lt;/code&gt; just like other components with animations.
Hovever, I also see several issues with this approach:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The timer is tied to the display refresh rate, which means no mater how small we set the step, the loop will suspend on each frame (this could be a good thing). However, for that reason, the timer will probably be less presize.&lt;/li&gt;
&lt;li&gt;It probably introduces more overhead due to abstractions and callback (compared to system call to &lt;code class=&quot;language-text&quot;&gt;SystemClock.uptimeMillis()&lt;/code&gt;).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;It would probably be an overkill to write a timer this way, but inspite of all this, I still had a lot of fun digging into it.&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;We’ve looked into several implementations of a countdown timer in Jetpack Compose. I am sure there are more and we just scratched the surface. I would personally use the approach with &lt;code class=&quot;language-text&quot;&gt;SystemClock.uptimeMillis()&lt;/code&gt;, but I think that &lt;code class=&quot;language-text&quot;&gt;withFrameMillis()&lt;/code&gt; isn’t such a bad idea either. Let me know what you think. :)&lt;/p&gt;</content:encoded></item><item><title><![CDATA[No title]]></title><description><![CDATA[Android Gradle Plugin requires Java 11 to run. You are currently using java 1.8. I’ve spent several nights this week to get one of my…]]></description><link>https://www.antondanshin.com/blog/updating-to-android-gradle-plugin-7</link><guid isPermaLink="false">https://www.antondanshin.com/blog/updating-to-android-gradle-plugin-7</guid><pubDate>Sat, 25 Sep 2021 15:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;strong&gt;Android Gradle Plugin requires Java 11 to run. You are currently using java 1.8.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;I’ve spent several nights this week to get one of my project’s CI pipeline back up on its feet after upgrading to the latest Android gradle plugin (7.0.2). I usually try to keep versions of tools and lbraries up-to-date, but after haven’t got time to work on the project and couldn’t keep up. As a result, the app was not updated for the last 4 months – the time when Google suddenly released a bunch of updates to Android’s build tools, which broke everything…&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;It has never been like this and now it is exactly the same again.&lt;/strong&gt; — Viktor Chernomyrdin&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;Breaking changes in Gradle 7.x&lt;/h2&gt;
&lt;p&gt;Android Gradle Plugin now shares the same major version number with Gradle, so its version jumped from 4.x to 7.0. This is a good thing, as there will be less confusion with the versions. But this version bump comes with some changes. In addition to breaking changes to the plugin APIs, which forced me to update several other third-party gradle plugins (e.g. Sentry), Android Gradle Plugin adds some requirements to the environment.&lt;/p&gt;
&lt;h3&gt;Updating to JDK 11&lt;/h3&gt;
&lt;p&gt;Previously, everything would compile with JDK 8. Now Android Gradle Plugin requires JDK 11.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;An exception occurred applying plugin request [id: &apos;com.android.application&apos;]
&gt; Failed to apply plugin &apos;com.android.internal.application&apos;.
   &gt; Android Gradle plugin requires Java 11 to run. You are currently using Java 1.8.
     You can try some of the following options:
       - changing the IDE settings.
       - changing the JAVA_HOME environment variable.
       - changing `org.gradle.java.home` in `gradle.properties`.&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;On MacOS tt can be installed with &lt;code class=&quot;language-text&quot;&gt;Homebrew&lt;/code&gt; with the following command: &lt;code class=&quot;language-text&quot;&gt;brew install --cask adoptopenjdk11&lt;/code&gt;. There is also a nice article on how to enable quick &lt;a href=&quot;https://mkyong.com/java/how-to-set-java_home-environment-variable-on-mac-os-x/#switch-between-different-jdk-versions&quot;&gt;switching between JDK versions&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;I thought this was it, so I moved on with the development of my feature. Later, when I was ready to present an early prototype for testing, I found out that our CI server was unable to build the app. All because CI was trying to build it with JDK 8. Luckily, we run our Android builds inside a docker container. And I thought to myself:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;This where docker will show it’s power!
All I need to do is to replace package &lt;code class=&quot;language-text&quot;&gt;openjdk-8-jdk&lt;/code&gt; with &lt;code class=&quot;language-text&quot;&gt;openjdk-11-jdk&lt;/code&gt; in my Dockerfile, and everything should work, just like on my local machine.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Build failed again when running Android &lt;code class=&quot;language-text&quot;&gt;sdkmanager&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Step 13/18 : RUN yes | sdkmanager --licenses
Exception in thread &quot;main&quot; java.lang.NoClassDefFoundError: javax/xml/bind/annotation/XmlSchema
   at com.android.repository.api.SchemaModule$SchemaModuleVersion.&amp;lt;init&gt;(SchemaModule.java:156)
   at com.android.repository.api.SchemaModule.&amp;lt;init&gt;(SchemaModule.java:75)
    at com.android.sdklib.repository.AndroidSdkHandler.&amp;lt;clinit&gt;(AndroidSdkHandler.java:81)
    at com.android.sdklib.tool.sdkmanager.SdkManagerCli.main(SdkManagerCli.java:73)
    at com.android.sdklib.tool.sdkmanager.SdkManagerCli.main(SdkManagerCli.java:48)
Caused by: java.lang.ClassNotFoundException: javax.xml.bind.annotation.XmlSchema
    at java.base/jdk.internal.loader.BuiltinClassLoader.loadClass(BuiltinClassLoader.java:581)
   at java.base/jdk.internal.loader.ClassLoaders$AppClassLoader.loadClass(ClassLoaders.java:178)
    at java.base/java.lang.ClassLoader.loadClass(ClassLoader.java:522)
    ... 5 more
The command &apos;/bin/sh -c yes | sdkmanager --licenses&apos; returned a non-zero code: 1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It looks like when I put together this build script more than a year ago, I probably used some outdated sources of information. It used &lt;a href=&quot;https://developer.android.com/studio/releases/sdk-tools&quot;&gt;deprecated SDK tools&lt;/a&gt;, which apparently doesn’t work with Java 11 and haven’t been updated for a long time. I’ve spent quite some time trying to make it work before I realized that this was the dead end and I had to move on to the new Android &lt;a href=&quot;https://developer.android.com/studio#cmdline-tools&quot;&gt;command-line tools&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;My new Dockerfile with Android build environment for CI now looks like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;dockerfile&quot;&gt;&lt;pre class=&quot;language-dockerfile&quot;&gt;&lt;code class=&quot;language-dockerfile&quot;&gt;&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; ubuntu:18.04&lt;/span&gt;

&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;ENV&lt;/span&gt; LANG=&lt;span class=&quot;token string&quot;&gt;&apos;C&apos;&lt;/span&gt; LANGUAGE=&lt;span class=&quot;token string&quot;&gt;&apos;en&apos;&lt;/span&gt; LC_ALL=&lt;span class=&quot;token string&quot;&gt;&apos;C&apos;&lt;/span&gt;&lt;/span&gt;

&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;ENV&lt;/span&gt; DEBIAN_FRONTEND=noninteractive&lt;/span&gt;
&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;ENV&lt;/span&gt; GRADLE_HOME=/usr/bin/gradle&lt;/span&gt;
&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;ENV&lt;/span&gt; ANDROID_SDK_ROOT=/opt/android-sdk&lt;/span&gt;

&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; apt-get update &amp;amp;&amp;amp; apt-get install -y &lt;span class=&quot;token operator&quot;&gt;\&lt;/span&gt;
        --allow-downgrades --allow-remove-essential --allow-change-held-packages &lt;span class=&quot;token operator&quot;&gt;\&lt;/span&gt;
        expect &lt;span class=&quot;token operator&quot;&gt;\&lt;/span&gt;
        git &lt;span class=&quot;token operator&quot;&gt;\&lt;/span&gt;
        mc &lt;span class=&quot;token operator&quot;&gt;\&lt;/span&gt;
        gradle &lt;span class=&quot;token operator&quot;&gt;\&lt;/span&gt;
        unzip &lt;span class=&quot;token operator&quot;&gt;\&lt;/span&gt;
        wget curl &lt;span class=&quot;token operator&quot;&gt;\&lt;/span&gt;
        libc6-i386 lib32stdc++6 lib32gcc1 lib32ncurses5 lib32z1 &lt;span class=&quot;token operator&quot;&gt;\&lt;/span&gt;
        openjdk-11-jdk &lt;span class=&quot;token operator&quot;&gt;\&lt;/span&gt;
    &amp;amp;&amp;amp; rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*&lt;/span&gt;

&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; rm -f /etc/ssl/certs/java/cacerts; &lt;span class=&quot;token operator&quot;&gt;\&lt;/span&gt;
    /var/lib/dpkg/info/ca-certificates-java.postinst configure&lt;/span&gt;

&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;ENV&lt;/span&gt; PATH &lt;span class=&quot;token variable&quot;&gt;$PATH&lt;/span&gt;:/opt/tools&lt;/span&gt;

&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; cd /opt &lt;span class=&quot;token operator&quot;&gt;\&lt;/span&gt;
    &amp;amp;&amp;amp; wget --output-document=android-commandline-tools.zip &lt;span class=&quot;token operator&quot;&gt;\&lt;/span&gt;
        https://dl.google.com/android/repository/commandlinetools-linux-7583922_latest.zip &lt;span class=&quot;token operator&quot;&gt;\&lt;/span&gt;
    &amp;amp;&amp;amp; mkdir -p &lt;span class=&quot;token variable&quot;&gt;${ANDROID_SDK_ROOT}&lt;/span&gt;/cmdline-tools &lt;span class=&quot;token operator&quot;&gt;\&lt;/span&gt;
    &amp;amp;&amp;amp; unzip android-commandline-tools.zip -d &lt;span class=&quot;token variable&quot;&gt;${ANDROID_SDK_ROOT}&lt;/span&gt;/cmdline-tools &lt;span class=&quot;token operator&quot;&gt;\&lt;/span&gt;
    &amp;amp;&amp;amp; mv &lt;span class=&quot;token variable&quot;&gt;${ANDROID_SDK_ROOT}&lt;/span&gt;/cmdline-tools/cmdline-tools &lt;span class=&quot;token variable&quot;&gt;${ANDROID_SDK_ROOT}&lt;/span&gt;/cmdline-tools/latest &lt;span class=&quot;token operator&quot;&gt;\&lt;/span&gt;
    &amp;amp;&amp;amp; rm -v android-commandline-tools.zip &lt;span class=&quot;token operator&quot;&gt;\&lt;/span&gt;
    &amp;amp;&amp;amp; chown -R root.root /opt/android-sdk&lt;/span&gt;

&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;ENV&lt;/span&gt; ANDROID_HOME &lt;span class=&quot;token string&quot;&gt;&quot;${ANDROID_SDK_ROOT}&quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;ENV&lt;/span&gt; JAVA_HOME  /usr/lib/jvm/java-11-openjdk-amd64&lt;/span&gt;
&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;ENV&lt;/span&gt; PATH &lt;span class=&quot;token variable&quot;&gt;$PATH&lt;/span&gt;:&lt;span class=&quot;token variable&quot;&gt;$JAVA_HOME&lt;/span&gt;/bin:&lt;span class=&quot;token variable&quot;&gt;$ANDROID_HOME&lt;/span&gt;/cmdline-tools/latest/bin&lt;/span&gt;

&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; yes | sdkmanager --licenses&lt;/span&gt;
&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; sdkmanager --update&lt;/span&gt;

&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;ADD&lt;/span&gt; packages.txt &lt;span class=&quot;token variable&quot;&gt;$ANDROID_SDK_ROOT&lt;/span&gt;&lt;/span&gt;

&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; yes | sdkmanager --package_file=&lt;span class=&quot;token variable&quot;&gt;$ANDROID_SDK_ROOT&lt;/span&gt;/packages.txt&lt;/span&gt;

&lt;span class=&quot;token instruction&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;ENV&lt;/span&gt; PATH &lt;span class=&quot;token variable&quot;&gt;$PATH&lt;/span&gt;:&lt;span class=&quot;token variable&quot;&gt;$ANDROID_HOME&lt;/span&gt;/tools:&lt;span class=&quot;token variable&quot;&gt;$ANDROID_HOME&lt;/span&gt;/tools/bin:&lt;span class=&quot;token variable&quot;&gt;$ANDROID_HOME&lt;/span&gt;/platform-tools&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Broken release build&lt;/h3&gt;
&lt;p&gt;So, I finally had an environment on my CI that can build my app. But when it tried to make a release apk, it failed again.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/07db1087d81e271fbdf20d5a7de3b3f8/1cb21/broken-ci-build.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 34.810126582278485%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABdElEQVQozyWPiarbMBBF/f9f9iAQKG2TZvMuW5JlW5YUL2meT4k6MMxwN2aS7/ebfd/51LZtCCHwweO95/l8Yu0Y8XVdcd7FfZ5nxnHEOUfwHmstIQRC8CSfoO99573vzPNCnuX0pke2CtMZ6qomuMBkHUpqJjsxmIG2aVFdhzYG0bRR2+mOZCpyrGxZjcGNHWKsUU7Szx1qammGGhM07SRJZR45OUkaU+HqCptnjFlK7xT905CMf06Y+4WtLJh0SREymrlCbgIxl5Q+Q21NxNL+FqdYKqrxwfL7B8vxQDge0K5AbZKkPZ9oLifs/Yqqblz0ORqLKeVhrlzVmdw+SPs75+YX2XAnHe7c2hP255Hx8EV3+KLUF0pXkEgz0JuO17LhFxsvkrNAvyTtXFP5Ar21yEWQD4/IffDa5WhboMaMxjxQi6BbFUnTjdjJ8nq98aujCjlyaTBv9d8Yihiu1obqE7K1sT+vm7dGvSRiqaO+/9vxDzBYDOI4Xk9JAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Broken release apk build on CI&quot;
        title=&quot;Broken release apk build on CI&quot;
        src=&quot;/static/07db1087d81e271fbdf20d5a7de3b3f8/f058b/broken-ci-build.png&quot;
        srcset=&quot;/static/07db1087d81e271fbdf20d5a7de3b3f8/c26ae/broken-ci-build.png 158w,
/static/07db1087d81e271fbdf20d5a7de3b3f8/6bdcf/broken-ci-build.png 315w,
/static/07db1087d81e271fbdf20d5a7de3b3f8/f058b/broken-ci-build.png 630w,
/static/07db1087d81e271fbdf20d5a7de3b3f8/40601/broken-ci-build.png 945w,
/static/07db1087d81e271fbdf20d5a7de3b3f8/78612/broken-ci-build.png 1260w,
/static/07db1087d81e271fbdf20d5a7de3b3f8/1cb21/broken-ci-build.png 2586w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;The error now was in Sentry gradle plugin:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;&gt; Task :app:addSentryProguardSettingsForRelease FAILED

FAILURE: Build failed with an exception.

* What went wrong:
A problem was found with the configuration of task &apos;:app:addSentryProguardSettingsForRelease&apos; (type &apos;SentryProguardConfigTask&apos;).
  - Type &apos;io.sentry.android.gradle.SentryProguardConfigTask&apos; property &apos;applicationVariant&apos; is missing an input or output annotation.

    Reason: A property without annotation isn&apos;t considered during up-to-date checking.

    Possible solutions:
      1. Add an input or output annotation.
      2. Mark it as @Internal.&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Apparentrly, during last few months technologies made a big step forward. Gradle has removed some deprecated plugin API, used by older version of Sentry plugin. Sentry also released a bunch of updates that I missed.&lt;/p&gt;
&lt;p&gt;The annoying par was that the error only showed itself during compilation of &lt;code class=&quot;language-text&quot;&gt;release&lt;/code&gt; type. Lint also didn’t alarm me about presence of a more recent version of the plugin. Anyway, updating &lt;code class=&quot;language-text&quot;&gt;sentry-android-gradle-plugin&lt;/code&gt; from 1.7.36 to latest 2.1.4 fixed the problems.&lt;/p&gt;
&lt;h2&gt;Fixing R8 full mode&lt;/h2&gt;
&lt;p&gt;After updating CI environment, I finally was able to build a proper release APK. However, when I run the app, it just crashed.&lt;/p&gt;
&lt;p&gt;There was a problem with R8 full mode, which appeared after update. Deobfuscated stacktrace looked like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Caused by java.lang.ClassCastException: java.lang.Class cannot be cast to java.lang.reflect.ParameterizedType
    at retrofit2.HttpServiceMethod.parseAnnotations(HttpServiceMethod.java:46)
    at retrofit2.ServiceMethod.parseAnnotations(ServiceMethod.java:39)
    at retrofit2.Retrofit.loadServiceMethod(Retrofit.java:202)
    at retrofit2.Retrofit.validateServiceInterface(Retrofit.java:189)
    at retrofit2.Retrofit.create(Retrofit.java:141)
    ...&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The issue is not reproduced with &lt;code class=&quot;language-text&quot;&gt;android.enableR8.fullMode=false&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;I almost decided to disable R8 full mode but suddenly I found a question with &lt;a href=&quot;https://stackoverflow.com/q/69098376/1199452&quot;&gt;similar problem&lt;/a&gt; on StackOverflow. The answer had a bunch of ProGuard rules that work, but actually redundant.&lt;/p&gt;
&lt;p&gt;It looks like in R8 full mode, generic type of an implicit parameter &lt;code class=&quot;language-text&quot;&gt;kotlin.coroutines.Continuation&amp;lt;T&gt;&lt;/code&gt; in &lt;code class=&quot;language-text&quot;&gt;suspend&lt;/code&gt; functions gets erased. That’s why adding the following line to &lt;code class=&quot;language-text&quot;&gt;proguard-rules.pro&lt;/code&gt; solves the above error:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;-keep,allowobfuscation,allowshrinking class kotlin.coroutines.Continuation&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Updated Google Play requirements&lt;/h2&gt;
&lt;p&gt;Although I finally was able to fix my CI build pipeline and build rlease APK, the fight wasn’t over yet. Since August 2021, Google Play bumped the requirement for published apps to target Androdi SDK 31. It also now only accepts app bundles (.aab) rather than APKs.
This is a smaller issue but yet another hurdle I need overcome in order to publish an update to Google Play.&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;I was not ready to spend that much time trying to make a new app release and it was a bit of a challenge. I did not expect that just after a few months of not working with the project, I would have to go through all this. I was planning to spend just one weekend to make this feature available for testing, but ended up working the evenings of the following week.&lt;/p&gt;
&lt;p&gt;Many of these problems could have been avoided. All breaking changes in the APIs of the tools and libraries that we use do not happen overnight – they are uaually announced months and sometimes even years in advance. These announcement should not be ignored, and actions should not be put off till the last minute.&lt;/p&gt;
&lt;p&gt;Everything works now, so not all is bad. Plus, this little experience with scripts I had was quite educational and inspiring. On the same evening that I fixed my CI build, I was also able to automate the deployment of this blog to Github Pages.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[No title]]></title><description><![CDATA[As promised in my first blog post, I’m sharing how I set up a Gatsby blog and deployed it to Github Pages.
There is a lot of material on the…]]></description><link>https://www.antondanshin.com/blog/creating-blog</link><guid isPermaLink="false">https://www.antondanshin.com/blog/creating-blog</guid><pubDate>Wed, 22 Sep 2021 22:30:00 GMT</pubDate><content:encoded>&lt;p&gt;As promised in my first blog post, I’m sharing how I set up a Gatsby blog and deployed it to Github Pages.
There is a lot of material on the Internet on this particular topic, but I still want to document my experience in case I need to do it again.&lt;/p&gt;
&lt;p&gt;I split this into two posts. Here is what we’ll cover in this one:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;How to install Node.js and Gatsby on MacOS.&lt;/li&gt;
&lt;li&gt;How to create a blog from a blog-starter template.&lt;/li&gt;
&lt;li&gt;Explain project structure and how it works.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Publishing to GitHub pages will be in the next post.&lt;/p&gt;
&lt;h2&gt;Installing our tools&lt;/h2&gt;
&lt;p&gt;To build a website with Gatsby.js, you need to install Node.js. Node is a JavaScript runtime built on Chrome’s javascript engine. Just like you need JRE to run Java apps, you also need some environment (e.g., a web-browser) to run javascript programs. Node.js lets you run javascript without the browser. It also comes with a package manager, which gives you access to thousands of libraries and tools.&lt;/p&gt;
&lt;h3&gt;Installing Node.js&lt;/h3&gt;
&lt;p&gt;You may go ahead and install the latest stable Node version. But because there are many versions of Node (just like with Java), and different projects might require different versions of Node, there is this tool called “nvm” or Node Version Manager. Usually, you would install this first and then use it to install a desired version of Node.js. The advantage of using nvm is that you can have several versions of Node.js and switch between them with a command.&lt;/p&gt;
&lt;p&gt;To install LTS version of Node.js on MacOS run these two commands:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# installing VVM&lt;/span&gt;
brew &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; nvm
&lt;span class=&quot;token comment&quot;&gt;# installing LTS version of Node.js&lt;/span&gt;
nvm &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; --lts&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Run &lt;code class=&quot;language-text&quot;&gt;node --version&lt;/code&gt; to check the installed version.&lt;/p&gt;
&lt;h3&gt;Installing Gatsby CLI&lt;/h3&gt;
&lt;p&gt;Gatsby.js is not just a JS framework, it’s a toolkit that, among other things, includes a development HTTP-server, web GraphQL IDE. To manage it all, they ship a command-line tool, aka &lt;a href=&quot;https://www.gatsbyjs.com/docs/reference/gatsby-cli/&quot;&gt;Gatsby CLI&lt;/a&gt;, which can be installed with &lt;code class=&quot;language-text&quot;&gt;npm&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# install Gatsby CLI globally&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;npm&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; -g gatsby-cli&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Creating a blog with Gatsby&lt;/h2&gt;
&lt;p&gt;You can create a new website with &lt;code class=&quot;language-text&quot;&gt;gatsby new&lt;/code&gt; and write initial boilerplate yourself, but CLI tools provide a convenient way to create a project from a variety of templates. I chose the simplest thing that is available out there, which is &lt;a href=&quot;https://www.gatsbyjs.com/starters/gatsbyjs/gatsby-starter-blog&quot;&gt;Gatsby Starter Blog&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;Creating website from a template&lt;/h3&gt;
&lt;p&gt;Navigate to the directory where you want to create your project and run the following command (replace &lt;code class=&quot;language-text&quot;&gt;YOUR-PROJECT-NAME-HERE&lt;/code&gt; with the name of your project):&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;npx gatsby new YOUR-PROJECT-NAME-HERE https://github.com/gatsbyjs/gatsby-starter-blog&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Gatsby will create a directory and set up a website based on provided template.&lt;/p&gt;
&lt;p&gt;You can run your website with &lt;code class=&quot;language-text&quot;&gt;gatsby develop&lt;/code&gt;.&lt;/p&gt;
&lt;h3&gt;Project structure&lt;/h3&gt;
&lt;p&gt;Here is how my project structure looks like as of now:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;./
├── package.json
├── gatsby-browser.js
├── gatsby-config.js
├── gatsby-node.js
├── src
│   ├── components
│   │   ├── bio.js
│   │   ├── layout.js
│   │   └── seo.js
│   ├── images
│   │   ├── gatsby-icon.png
│   │   └── profile-pic.jpg
│   ├── normalize.css
│   ├── pages
│   │   ├── 404.js
│   │   ├── index.js
│   │   └── using-typescript.tsx
│   ├── style.css
│   └── templates
│       └── blog-post.js
├── content
│   └── blog
│       ├── creating-blog
│       │   └── index.md
│       └── hello-world
│           └── index.md
├── public
│   └──...
└── static
    └── ...&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;All these files and directories have the following functions:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;package.json&lt;/code&gt; – is a file that lists project build config and dependencies.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;gatsby-config.js&lt;/code&gt; – main configuration file of gatsby site, contains plugin declaration and setup.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;gatsby-browser.js&lt;/code&gt; – allows customization/extension of default Gatsby settings affecting the browser.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;gatsby-node.js&lt;/code&gt; – the main module that will be invoked by Gatsby to generate website pages.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;src&lt;/code&gt; – the derectory with the website’s javascript code that will be run by Gatsby and &lt;code class=&quot;language-text&quot;&gt;gatsby-node.js&lt;/code&gt; to render pages.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;src/components&lt;/code&gt; – a directory where we can put reusable react components.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;src/pages&lt;/code&gt; – the code used to render pages: each js file will generate its own page.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;src/teplates&lt;/code&gt; – similar to previous, but will be used for generating multiple pages (like blog posts).&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;content&lt;/code&gt; - contains directories with Markdown files that will be transformed into blog posts.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;public&lt;/code&gt; – output directory with a generated website.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;How it works&lt;/h3&gt;
&lt;p&gt;This is what happens when you run &lt;code class=&quot;language-text&quot;&gt;gatsby develop&lt;/code&gt;:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Gatsby will run the code from &lt;code class=&quot;language-text&quot;&gt;gatsby-node.js&lt;/code&gt;, and applies plugins and config provided in &lt;code class=&quot;language-text&quot;&gt;gatsby-config.js&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;gatsby-browser.js&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Gatsby will generate index and 404 pages using code defined in &lt;code class=&quot;language-text&quot;&gt;src/pages&lt;/code&gt; directory. They will be rendered with &lt;code class=&quot;language-text&quot;&gt;Layout&lt;/code&gt; component defined in &lt;code class=&quot;language-text&quot;&gt;src/components/layout.js&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Pluging will be applied at different steps of the build process.
&lt;ul&gt;
&lt;li&gt;Particularly, plugin &lt;code class=&quot;language-text&quot;&gt;gatsby-transformer-remark&lt;/code&gt; will scan &lt;code class=&quot;language-text&quot;&gt;contents&lt;/code&gt; folder and transform all markdown into structured data, that can be retrieved with GraphQL API.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;gatsby-plugin-feed&lt;/code&gt; will generate RSS feed.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;gatsby-node.js&lt;/code&gt; will query for all blog posts and generate pages for them during build time using &lt;code class=&quot;language-text&quot;&gt;src/templates/blog-post.js&lt;/code&gt; component.&lt;/li&gt;
&lt;li&gt;Generated content is placed into &lt;code class=&quot;language-text&quot;&gt;public&lt;/code&gt; folder and served by local HTTP server at &lt;code class=&quot;language-text&quot;&gt;http://localhost:8000/&lt;/code&gt;.&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;Customizing your website&lt;/h3&gt;
&lt;p&gt;The main focus for me was to get rid of old content and figure out how everything works by tweaking some things. All I did is:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Removed old content and replaced with my own (including site meta data).&lt;/li&gt;
&lt;li&gt;Fixed some CSS, e.g., fixed round avatar on Safari.&lt;/li&gt;
&lt;li&gt;Added two meta parameters to blog posts: “updated” and “draft” and used them in pages.&lt;/li&gt;
&lt;li&gt;Added read time estimate (via plugin &lt;code class=&quot;language-text&quot;&gt;gatsby-remark-reading-time&lt;/code&gt;).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;My initial impression of the code and project in general was pretty poor. I have only been using strongly typed languages, and when I first saw the code in the project, I thought it was a mess. I thought it would take me a lot of time to figure things out and get the blog going. In the end, I quickly picked up the main idea of how it works, and now it is not as scary as it initially seemed.&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;I’ve set up Node.js on my Mac, installed gatsby, and created a simple blog. In my next post, I will describe how I published the website to GitHub Pages and set up auto-deployment.&lt;/p&gt;
&lt;p&gt;Thanks for reading.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[No title]]></title><description><![CDATA[I decided to teach myself some modern web technologies and put together a static blog based on Gatsby.js. Who am I? My name is Anton. I am a…]]></description><link>https://www.antondanshin.com/blog/hello-world</link><guid isPermaLink="false">https://www.antondanshin.com/blog/hello-world</guid><pubDate>Sat, 18 Sep 2021 17:00:00 GMT</pubDate><content:encoded>&lt;p&gt;I decided to teach myself some modern web technologies and put together a static blog based on Gatsby.js.&lt;/p&gt;
&lt;h3&gt;Who am I?&lt;/h3&gt;
&lt;p&gt;My name is Anton. I am a professional Android developer.
I am going to create a dedicated &lt;strong&gt;About&lt;/strong&gt; page with more information, but for now, I think this is enough.&lt;/p&gt;
&lt;h3&gt;What will I be blogging about?&lt;/h3&gt;
&lt;p&gt;I don’t know yet. I think I’ll be posting about my work. But I could also post about some other life stuff. If this thing doesn’t sink, I plan to add Portfolio and CV sections. We’ll see.&lt;/p&gt;
&lt;h3&gt;Why do I need a blog?&lt;/h3&gt;
&lt;p&gt;I had a WordPress blog more than six years ago but somehow abandoned it. Although it took quite a bit of effort to publish articles at times, I have to admit results were rather rewarding. I did enjoy sharing my knowledge, and based on comments I received from my old blog, it helped some people.&lt;/p&gt;
&lt;p&gt;Of course, there are other ways of sharing knowledge. But throughout my career as a software engineer, I realized that I don’t enjoy making presentations. I usually work on something that I cannot open source on Github. I don’t usually go on meet-ups, etc.&lt;/p&gt;
&lt;p&gt;Sharing knowledge is not the only reason why one would want to maintain a blog:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;If a blog focuses on professional matters, it complements the author’s resume. I think that having a blog did help me with landing my first full-time job at a good company.&lt;/li&gt;
&lt;li&gt;Blogs help to organize your thoughts and can also be the channel to express one’s emotions freely.&lt;/li&gt;
&lt;li&gt;To a non-native speaker of English, writing a blog in this language helps to train their writing skills. I remember I did start writing my blog in English for this very reason.&lt;/li&gt;
&lt;li&gt;And you can learn (or reinforce) a bunch of other stuff too. Like HTML/CSS, JavaScript, and some other technologies.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Why don’t I use a blogging platform?&lt;/h3&gt;
&lt;p&gt;I had experience with WordPress and I can’t complain – everything worked. I’ve also tried to publish a couple of articles on Medium – no problem with that as well. My main motivation for starting a self-hosted static blog is to learn some new things in modern web development.&lt;/p&gt;
&lt;p&gt;I realized that over the past 8 years since I did anything for the web, the technologies have made a huge step forward. There is a lot to catch up with and honestly, it’s a bit overwhelming. I will have to make myself not try to eat the whole thing and split the process into bite-sized pieces. So, what do I plan to learn with this new blog?&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;First of all, I will need to host this blog somewhere. I don’t really wanna have a personal domain or hosting server at this point. The first thing that comes to my mind is Github Pages. So, if you are reading this in 2021, this is probably where it is hosted.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;I will also have to dive into this static website development thing and Gatsby.js in particular. Right now, a lot is like magic to me. As I add features and improve the design, I will have to learn some javascript and CSS. So, this website will be my main playground.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Hopefully, I will be able to add content regularly, and because of that, I will need to automate the deployment process. In the beginning, it’s probably going to be just a simple bash script. Then I would need to wrap it into a docker image to make the scrip platform-independent and enable me to deploy the website with the click of a button on Github Actions.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I’ll be posting my journey through these steps in this blog. Stay tuned.&lt;/p&gt;</content:encoded></item></channel></rss>